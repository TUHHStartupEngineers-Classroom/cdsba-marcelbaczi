{
  "hash": "f52ec88a364ba08b149a59ac5fd01799",
  "result": {
    "markdown": "---\ntitle: \"Matching and Subclassification\"\n---\n\n\n# Assignment 1\n\n\n::: {.cell hash='07_matching_cache/html/unnamed-chunk-1_411febac1ca399d5241274a9148280d6'}\n\n```{.r .cell-code}\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> \n#> Attaching package: 'ggdag'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n#> The following object is masked from 'package:stats':\n#> \n#>     filter\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\ndata<-readRDS(\"C:/Users/Marcel/Master/DataScience/data/membership.rds\")\nhead(data)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"age\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sex\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"pre_avg_purch\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"card\"],\"name\":[4],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"avg_purch\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"31.3\",\"2\":\"1\",\"3\":\"61.14632\",\"4\":\"0\",\"5\":\"70.77889\"},{\"1\":\"40.7\",\"2\":\"1\",\"3\":\"42.96728\",\"4\":\"1\",\"5\":\"51.36155\"},{\"1\":\"23.2\",\"2\":\"1\",\"3\":\"18.00792\",\"4\":\"1\",\"5\":\"25.96521\"},{\"1\":\"65.3\",\"2\":\"0\",\"3\":\"81.97980\",\"4\":\"1\",\"5\":\"123.99519\"},{\"1\":\"27.2\",\"2\":\"0\",\"3\":\"61.43390\",\"4\":\"0\",\"5\":\"45.12074\"},{\"1\":\"52.4\",\"2\":\"1\",\"3\":\"90.28035\",\"4\":\"0\",\"5\":\"113.26259\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ndag<-dagify(avg_purch ~ card,\n              card ~ age + sex + pre_avg_purch,\n              pre_avg_purch ~ sex + age,\n              exposure = \"card\",\n              outcome = \"avg_purch\")\n\n\nggdag(dag)\n```\n\n::: {.cell-output-display}\n![](07_matching_files/figure-html/unnamed-chunk-1-1.png){width=672}\n:::\n:::\n\n\n# Assignment 2\n\n\n::: {.cell hash='07_matching_cache/html/unnamed-chunk-2_fb1cf9953bd0bab67af0fb854e998791'}\n\n```{.r .cell-code}\nmodel_naive<-lm(avg_purch ~ card, data = data)\nsummary(model_naive)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = avg_purch ~ card, data = data)\n#> \n#> Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -101.515  -20.684   -0.199   20.424  120.166 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  65.9397     0.3965  166.29   <2e-16 ***\n#> card         25.2195     0.6095   41.38   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 30.11 on 9998 degrees of freedom\n#> Multiple R-squared:  0.1462,\tAdjusted R-squared:  0.1461 \n#> F-statistic:  1712 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n# Assignment 3\n\n## 1\n\n\n::: {.cell hash='07_matching_cache/html/unnamed-chunk-3_5dd189fce41957c2b9019ec5403705de'}\n\n```{.r .cell-code}\nlibrary(MatchIt)\ncem = matchit(card ~ age + sex + pre_avg_purch, data=data, method='cem', estimant='ATE')\ndf_cem<-match.data(cem)\nlm_cem<-lm(avg_purch ~ card, data=df_cem, weights=weights)\nsummary(lm_cem)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = avg_purch ~ card, data = df_cem, weights = weights)\n#> \n#> Weighted Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -100.835  -23.724   -5.299   15.436  217.036 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  75.2842     0.3946   190.8   <2e-16 ***\n#> card         15.1944     0.6078    25.0   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 29.83 on 9878 degrees of freedom\n#> Multiple R-squared:  0.0595,\tAdjusted R-squared:  0.05941 \n#> F-statistic:   625 on 1 and 9878 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## 2\n\n\n::: {.cell hash='07_matching_cache/html/unnamed-chunk-4_568405558c8d2556adabb65e9326e06d'}\n\n```{.r .cell-code}\nnn<-matchit(card ~ age + pre_avg_purch , data=data, method=\"nearest\", distance = \"mahalanobis\", replace = T )\ndf_nn<-match.data(nn)\nmodel_nn<-lm(avg_purch ~ card, data=df_nn ,weights=weights)\nsummary(model_nn)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = avg_purch ~ card, data = df_nn, weights = weights)\n#> \n#> Weighted Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -101.515  -21.159   -1.517   18.610  181.319 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  76.2067     0.5844  130.40   <2e-16 ***\n#> card         14.9524     0.7479   19.99   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 30.37 on 6930 degrees of freedom\n#> Multiple R-squared:  0.05453,\tAdjusted R-squared:  0.05439 \n#> F-statistic: 399.7 on 1 and 6930 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n\n\n## 3\n\n\n::: {.cell hash='07_matching_cache/html/unnamed-chunk-5_8e2a4f259d7c54625258c116bc02e813'}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n#> ✔ dplyr     1.1.4     ✔ readr     2.1.4\n#> ✔ forcats   1.0.0     ✔ stringr   1.5.0\n#> ✔ lubridate 1.9.3     ✔ tibble    3.2.1\n#> ✔ purrr     1.0.2     ✔ tidyr     1.3.0\n#> ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n#> ✖ dplyr::filter() masks ggdag::filter(), stats::filter()\n#> ✖ dplyr::lag()    masks stats::lag()\n#> ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nmodel_prop<-glm(card ~ age + sex + pre_avg_purch, data=data, family = binomial(link = \"logit\"))\ndf_aug<-data %>% mutate(propensity = predict(model_prop, type = \"response\"))\ndf_ipw<-df_aug %>% mutate(ipw = (card/propensity) + ((1-card) / (1-propensity)))\nmodel_ipw<-lm(avg_purch~card,data=df_ipw,weights=ipw)\nsummary(model_ipw)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = avg_purch ~ card, data = df_ipw, weights = ipw)\n#> \n#> Weighted Residuals:\n#>      Min       1Q   Median       3Q      Max \n#> -205.353  -28.995   -0.275   28.787  214.307 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  70.2628     0.4320  162.66   <2e-16 ***\n#> card         14.9573     0.6109   24.48   <2e-16 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 43.19 on 9998 degrees of freedom\n#> Multiple R-squared:  0.05657,\tAdjusted R-squared:  0.05647 \n#> F-statistic: 599.5 on 1 and 9998 DF,  p-value: < 2.2e-16\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}